<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:flexlib="flexlib.containers.*"
	layout="absolute" width="800" height="600" windowComplete="init()">
<mx:Script>
<![CDATA[
	import mx.controls.Label;
	import mx.controls.HTML;
	import flexlib.controls.tabBarClasses.SuperTab;
	import mx.events.ListEvent;
	[Bindable]
	public var contexts:XML;
	[Bindable]
	public var address:String = "";
	public var homepage:String = "http://www.cbc.ca";
	
	[Embed(source="./flexlib/assets/document.png")]
	private var document_icon:Class;
	
	[Embed(source="./flexlib/assets/home.png")]
	private var home_icon:Class;

	
	public function init():void
	{
		var file:File = File.applicationDirectory.resolvePath("test.xml"); 
		var fileStream:FileStream = new FileStream(); 
		fileStream.open(file, FileMode.READ); 
		var stringRead:String = fileStream.readUTFBytes(fileStream.bytesAvailable);
		contexts = XML(stringRead); 
		fileStream.close();
		
		addContext("Default");
		//addTab(homepage, nav2, homepage);
	}
	
	public function treeItemDoubleClicked(e:ListEvent):void
	{
		trace(XML(e.itemRenderer.data).localName());
	}
	
	private function addContext(lbl:String):void
	{
		if(lbl=="") lbl = "(Default)";
		
		var child:VBox = new VBox();
		child.setStyle("closable", true);
		child.label = lbl;
		
		if(icon) {
			child.icon = icon;
		}
		else {
			child.icon = document_icon;
		}
		
		var nav2:SuperTabNavigator = new SuperTabNavigator();
		nav2.percentWidth = 100;
		nav2.percentHeight = 100;
		
		addTab(homepage, nav2, homepage);
		
		child.addChild(nav2);
		contextTabBar.addChild(child);
	}
	
	private function addTab(lbl:String, navigator:SuperTabNavigator, address:String, icon:Class=null):void 
	{
		if(lbl=="") lbl = "(Untitled)";
		
		var child:VBox = new VBox();
		child.setStyle("closable", true);
		child.label = lbl;
		
		if(icon) {
			child.icon = icon;
		}
		else {
			child.icon = document_icon;
		}
		
		var page:HTML = new HTML();
		page.location = address;		
		child.addChild(page);
		
		navigator.addChild(child);
	}

]]>
</mx:Script>

	<mx:VBox x="9" y="9" width="100%" height="100%">
		<mx:HBox width="100%" height="25">
			<mx:Text textAlign="left" height="31" text="Address"/>
			<mx:TextInput width="100%" height="25" id="addressInput" text="{address}" enter="address=addressInput.text;"/>
			<mx:Button label="Go" width="42" height="24" click="address=addressInput.text;"/>
		</mx:HBox>
		<mx:HDividedBox width="100%" height="100%">
			<mx:Accordion width="150" height="100%">
				<mx:Canvas label="Active" width="100%" height="100%">
					<mx:Tree x="0" y="0" width="100%" height="100%" dataProvider="{contexts}" id="tree" 
						labelField="@label" showRoot="false"
						change="address = tree.selectedItem.@address;"
						doubleClickEnabled="true"
						itemDoubleClick="treeItemDoubleClicked(event)"/>
					
				</mx:Canvas>
				<mx:Canvas label="Inactive" width="100%" height="100%">
					
				</mx:Canvas>
			</mx:Accordion>
			<flexlib:SuperTabNavigator id="contextTabBar" scrollSpeed="25" dropShadowEnabled="true"
				stopScrollingEvent="{MouseEvent.MOUSE_OUT}" startScrollingEvent="{MouseEvent.MOUSE_OVER}"
				width="100%" height="100%" horizontalGap="0" editableTabLabels="true"
				closePolicy="{SuperTab.CLOSE_ALWAYS}"
				/>

			<!-- <mx:HTML x="801" y="278" width="100%" height="100%" id="html" location="{address}"
				scaleX="0.33" scaleY="0.33"/> -->
		</mx:HDividedBox>
	</mx:VBox>
</mx:WindowedApplication>
